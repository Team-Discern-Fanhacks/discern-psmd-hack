# compilation

The discern hack use makefiles to generate the various files used. Makefiles are a a file format that can be executed by the GNU program `make` (and a few other compatible tool). The definition to build the discern hack are stored in both the `Makefile` file (manually written) and `submake.mk` (automatically generated by `Makefile` using the script `generate_sub_makefile.py`).

Make is an incremental build system, meaning it will only recreate file when needed (for example, if you change the source of a `plb` file, it will only recreate the `plb` file).

Make use target. You can specify targets after the make command. For example, if you execute make with the make command, you can use `make patch` to call the target `patch` (that will build the patch). You can also add `-jX`, that will use up to `X` cores, (as in `make patch -j4` will use 4 core), allowing parrallelization for faster compilation. If you don't specify a target, it will default to `patch`. Thus, if you want to just build the patch with 4 cores, you can use `make -j4`.

Here is a list of useful target:
- `patch` : will build the patch folder, containing a patch that can be applied to the romfs of the console (how you can applie it is outside the scope of this guide, but I (marius851000) will be happy to help you if you need help).
- `patch.zip` : a zipped version of `patch`. Can be used if you want to share the compiled result.
- `install` : will copy the patch to the folder used for romfs patche for the US version of PSMD by citra. Please note you need a recent version of citra if you want to use this function and that some old version of citra will take a lot of time before starting the rom if a patch is present (you should update your citra version). It is also possible to use the EU version of the game by configuring the [`config.mk`](./config.mk.md).
- `uninstall` : will remove every patch to the romfs of citra of the US PSMD. This also apply to other mod you could have installed, like `PMD-Lua-Mod-Loader` by EddyK28.
- `clean` : remove file generated by `make`. Will not uninstall mods however.
- `book.zip` : build this book. As of now only work on linux.

Other targets exist too. You don't need to use them in a normal use case however.

Additionaly, please note that `lua`s files have their syntax checked at compile time, after being patched. This doesn't guarantee it won't crash, but will prevent syntax error sneaking in the file (those are hard to debug inside the game).
